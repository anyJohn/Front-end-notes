### http 基本概念

http 协议，Hyper Text Transfer Protocol，全称超文本传输协议，是一个基于 TCP 协议的应用层传输协议，即客户端和服务端进行数据传输的一种规则。是一种明文的无状态协议。

### http 版本

#### http/0.9

- 只支持`GET`请求方式
- 没有请求头
- 服务端响应后，立即关闭 TCP 连接

#### http/1.0

- 增加了`POST`、`HEAD`方法
- 规定了请求头、请求尾，响应头、响应尾
- 短连接，不支持`keep-alive`每次 TCP 只能发送一个请求，当服务器响应后就会关闭这次请求，TCP 连接的建立成本很高，所以开始时发送速率较慢。随着网页加载外部内容的增多，问题愈发严重。所有有些浏览器请求时使用了非标准的 Connection 字段来保持连接。

#### http/1.1

- 默认长连接，即默认`Connection:keep-alive`。改善了 http/1.0 短连接造成的性能浪费。
- 支持管道(pipeline)网络传输，只要第一个请求发送出去了，不必等其回来，就可以发送第二个请求出去，减少整体响应时间。
- 增加了`PUT`、`PATCH`、`OPTIONS`、`DELETE`、`CONNECT`、`TRACE`
- 支持断点续传

#### http/2.0

- 头部压缩，增强性能
- 二进制协议，http/2.0 是一个彻底的二进制协议，头信息和数据体都是二进制分帧，增加了传输速率
- 多路复用，有了二进制分帧，一个连接中，客户端和浏览器可以同时发送多个请求或回应，而且不用按照顺序一一对应。
- 服务端推送

### HTTP 缓存

http 缓存根据是否需要重新向服务器发起请求来分类，分为强制缓存和协商缓存。强制缓存如果生效，不需要再和服务器发生交互，而协商缓存不管是否生效，都需要与服务端发生交互。下面是强制缓存和协商缓存的一些对比。
![http缓存](./img/http%E7%BC%93%E5%AD%98.jpg)

#### 强制缓存

强制缓存在缓存数据未失效的情况下，就会直接使用浏览器的缓存数据。不会再向服务器发送任何请求，强制缓存生效时，http 状态码为 200。这种方式页面的加载速度是最快的，性能也很好，但是在此期间，服务器端的资源修改了，页面上是拿不到的，因为它不会再向服务器发请求了。这种就是我们在开发中经常遇到的，修改了某个页面的样式，但是在页面中刷新了却没有生效，因为走的是强缓存。Ctrl + F5 刷新之后就好了。
![强制缓存](./img/%E5%BC%BA%E5%88%B6%E7%BC%93%E5%AD%98%E8%AF%B7%E6%B1%82%E5%A4%B4.jpg)

#### 协商缓存

当第一次请求时，服务器的响应头中没有强制缓存字段（Cache-control、Expires）或者过期，或者设置了 no-cache，那么浏览器第二次请求就会与服务器协商，与服务器端对比判断资源是否进行了修改更新。如果服务器端没有进行修改，那么就会返回 304 状态码，告诉浏览器可以使用缓存中的数据，这样就减少了服务器的传输压力。如果数据有跟新就会返回 200 状态码，服务器就会返回更新后的资源和缓存信息。跟协商缓存相关的 header 头属性有（ETag/if-Not-Match、Last-Modified/If-Modified-Since）。请求头和响应头要成对出现。
![协商缓存](./img/%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98.jpg)

**协商缓存的流程:**
当浏览器第一次向服务器发送请求时，会在响应头中返回协商缓存的头属性：ETag 和 Last_modified，其中 ETag 返回的是一个 hash 值

### 请求头字段

### Cookie、sessionStorage、localStorage

- 都存放在本地客户端
- cookie 时服务端生成的，再发送给客户端保存，当客户端再次访问时，服务器可根据 cookie 辨识客户端是哪个。
- cookie 的大小不能超过 4kb；sessionStorage 和 localStorage 可以达到 5M+
- session 用于标记特定客户端信息，存在服务器的一个文件里，一般客户端带 cookie 对服务器进行访问，可通过 cookie 的 session id 从整个 session 中查询到服务器记录的关于客户端的信息。
- cookie 设置的过期时间之前一直有效，localStorage 永久存储，浏览器关闭后也不会丢失；sessionStorage 在当前浏览器窗口关闭后自动删除。
- cookie 的数据会自动传递到服务器；sessionStorage 和 localStorage 数据保存在本地。

### http 状态码

- 1XX，接收的信息正在处理
- 2XX，请求正常处理完毕
- 3XX，重定向
- 4XX，客户端错误
- 5XX，服务端错误

常见错误码：
301：永久重定向，302：临时重定向，400：客户端请求报文有误，403：服务器禁止访问资源，404：请求的资源在服务器上不存在，500：服务器内部错误

### GET 和 POST 的区别

- POST 更安全，GET 请求提交的数据会放在 url 上，post 会放在 request body 请求体里。
- GET 请求在 url 传递的参数中有长度限制，而 POST 没有。
- GET 回退浏览器无害，POST 会再次提交请求（GET 回退浏览器从缓存中拿结果，POST 每次都会创建新资源）。
- GET 请求参数会被完整保留在浏览历史记录里，可被存为书签而 POST 不能。
- GET 只能进行 url 编码，POST 支持多种编码格式
- POST 在发送数据前会将请求头发送给服务器进行确认，然后再发送真正的数据

### RESTful API

一种接口的规定风格，利用 http 中的 get、post、put、delete 等构成 REST 中的增删改查操作

- Create：POST
- Read：GET
- Update：PUT/PATCH
- Delete：DELETE

### https 基本概念

https 协议，以安全为目标的 http 通道，即在 http 下加入了 SSL 层进行加密。其作用是建立一个信息安全通道，确保数据的传输，确保网站的安全性。

### http 和 https 的区别和优缺点

- https 比 http 要安全，http 是明文传输的，客户端和服务器都无法验证对方身份，https 加入了 SSL 层（安全套接层）进行了对称加密，可防止数据在传输过程中不被窃取、改变、确保数据的完整性。
- http 的默认端口是`80`，https 的默认端口是`443`
- https 需要用到 ca 证书，因此需要一定费用
- https 握手阶段比较费时，会增加 50%页面加载时间，和 10%-20%的耗电
- https 连接缓存不如 http 高效，会增加数据开销。
- CA 证书需要绑定 ip，不能在同一 ip 上绑定多个域名，IPV4 资源支撑不了这种消耗
- https 的加密范围是有限的，CA 证书的信用链体系并不安全，特别是在某些国家可以控制根 CA 证书的情况，中间人攻击是可行的。

### https 协议的工作原理

1. 客户端使用 https url 访问服务器，要求 web 服务器建立`ssl连接`。
2. web 服务器接收到客户端的请求之后，`把证书（包含公钥）传输给客户端`。
3. 客户端解析证书，验证整数的合法性，生成对称加密密钥，我们将该密钥称之为 client key，即客户端密钥，用服务器的公钥对客户端密钥进行非对称加密。
4. 客户端将加密之后的客户端对称密钥发送给服务器。
5. 服务器收到客户端发来的密文之后，会用自己的私钥对其进行非对称解密，解密之后的明文就是客户端密钥，然后用客户端密钥对数据进行对称加密，这样数据就变成了密文。
6. 服务器将加密后的密文发送给客户端
7. 客户端收到服务器发来的密文，用客户端密钥进行对称解密，得到服务器啊发送的数据，https 传输完成。
